<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpendWise Pro - AI Personal Finance</title>
    
    <!-- CSS Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Babel for on-the-fly JSX/TS transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            letter-spacing: -0.011em;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        #root:empty { display: flex; align-items: center; justify-content: center; height: 100vh; font-weight: 500; color: #6366f1; background: #f8fafc; }
        #root:empty::after { content: "Authenticating Session..."; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        
        .glass-dock {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(20px) saturate(180%);
            border-top: 1px solid rgba(226, 232, 240, 0.8);
        }

        .premium-card {
            background: #ffffff;
            border: 1px solid #f1f5f9;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02), 0 2px 4px -1px rgba(0, 0, 0, 0.01);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .premium-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 10px 10px -5px rgba(0, 0, 0, 0.02);
        }

        .nav-indicator {
            position: absolute;
            left: 0;
            width: 3px;
            height: 24px;
            background: #6366f1;
            border-radius: 0 4px 4px 0;
            transition: all 0.3s ease;
        }
        
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0.4);
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react/": "https://esm.sh/react@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "recharts": "https://esm.sh/recharts@^3.6.0"
  }
}
</script>
</head>
<body class="bg-slate-50 text-slate-900 selection:bg-indigo-100 selection:text-indigo-700">
    <div id="root"></div>

    <script type="text/babel" data-presets="react,typescript" data-type="module">
        import React, { useState, useEffect, useMemo } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
          PieChart, Pie, Cell, ResponsiveContainer, 
          BarChart, Bar, XAxis, YAxis, Tooltip, CartesianGrid 
        } from 'https://esm.sh/recharts@2.12.7?deps=react@18.2.0,react-dom@18.2.0';
        import { GoogleGenAI, Type } from 'https://esm.sh/@google/genai@1.3.0';

        // --- CONSTANTS ---
        const Category = {
            FOOD: 'Food & Dining',
            TRANSPORT: 'Transport',
            SHOPPING: 'Shopping',
            ENTERTAINMENT: 'Entertainment',
            HEALTH: 'Health',
            BILLS: 'Bills & Utilities',
            INCOME: 'Income',
            OTHER: 'Other'
        };

        const CATEGORY_COLORS = {
            [Category.FOOD]: '#ef4444',
            [Category.TRANSPORT]: '#3b82f6',
            [Category.SHOPPING]: '#f59e0b',
            [Category.ENTERTAINMENT]: '#8b5cf6',
            [Category.HEALTH]: '#10b981',
            [Category.BILLS]: '#f97316',
            [Category.INCOME]: '#059669',
            [Category.OTHER]: '#64748b',
        };

        // --- SERVICES ---
        const API_BASE = '/api';
        const db = {
            getTransactions: async () => {
                try {
                    const res = await fetch(`${API_BASE}/transactions`);
                    if (!res.ok) throw new Error('API Error');
                    const data = await res.json();
                    localStorage.setItem('sw_v2_backup', JSON.stringify(data));
                    return data;
                } catch (e) {
                    return JSON.parse(localStorage.getItem('sw_v2_backup') || '[]');
                }
            },
            saveTransaction: async (t) => {
                try {
                    await fetch(`${API_BASE}/transactions`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(t)
                    });
                } catch (e) { console.error("MySQL Sync Failed"); }
                const local = JSON.parse(localStorage.getItem('sw_v2_backup') || '[]');
                const idx = local.findIndex(x => x.id === t.id);
                if (idx > -1) local[idx] = t; else local.unshift(t);
                localStorage.setItem('sw_v2_backup', JSON.stringify(local));
            },
            deleteTransaction: async (id) => {
                try { await fetch(`${API_BASE}/transactions/${id}`, { method: 'DELETE' }); } catch (e) {}
                const local = JSON.parse(localStorage.getItem('sw_v2_backup') || '[]').filter(x => x.id !== id);
                localStorage.setItem('sw_v2_backup', JSON.stringify(local));
            }
        };

        const geminiService = {
            getFinancialInsights: async (transactions) => {
                try {
                    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                    const response = await ai.models.generateContent({
                        model: 'gemini-3-flash-preview',
                        contents: `Analyze: ${JSON.stringify(transactions.map(t => ({ t: t.title, a: t.amount, c: t.category, ty: t.type })))}`,
                        config: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: Type.OBJECT,
                                properties: {
                                    summary: { type: Type.STRING },
                                    recommendations: { type: Type.ARRAY, items: { type: Type.STRING } },
                                    savingsPotential: { type: Type.STRING }
                                },
                                required: ["summary", "recommendations", "savingsPotential"]
                            }
                        }
                    });
                    return JSON.parse(response.text);
                } catch (error) { return null; }
            },
            suggestCategory: async (title) => {
                try {
                    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
                    const response = await ai.models.generateContent({
                        model: 'gemini-3-flash-preview',
                        contents: `Title: "${title}". Pick one: ${Object.values(Category).join(', ')}. Return just the category.`,
                    });
                    const suggestion = response.text.trim();
                    return Object.values(Category).includes(suggestion) ? suggestion : Category.OTHER;
                } catch (error) { return Category.OTHER; }
            }
        };

        // --- UI COMPONENTS ---
        const Icon = ({ name, className }) => {
            const icons = {
                dashboard: <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2H6a2 2 0 01-2-2v-4zM14 16a2 2 0 012-2h2a2 2 0 012 2v4a2 2 0 01-2 2h-2a2 2 0 01-2-2v-4z"/></svg>,
                transactions: <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>,
                insights: <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>,
                settings: <svg className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
            };
            return icons[name] || null;
        };

        const Layout = ({ children, activeTab, setActiveTab, onAdd }) => (
            <div className="flex flex-col min-h-screen md:pl-72 bg-slate-50/50">
                {/* Desktop Sidebar */}
                <aside className="hidden md:flex flex-col fixed left-0 top-0 bottom-0 w-72 bg-white border-r border-slate-100 z-50">
                    <div className="p-10">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-indigo-200">
                                <span className="font-black text-xl">S</span>
                            </div>
                            <h1 className="text-xl font-bold text-slate-900 tracking-tight">SpendWise <span className="text-indigo-600">Pro</span></h1>
                        </div>
                    </div>
                    
                    <nav className="flex-1 px-6 space-y-2 mt-4 relative">
                        {['dashboard', 'transactions', 'insights', 'settings'].map(tab => (
                            <button 
                                key={tab} 
                                onClick={() => setActiveTab(tab)} 
                                className={`group relative w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all duration-300 ${
                                    activeTab === tab ? 'bg-indigo-50/80 text-indigo-600' : 'text-slate-400 hover:text-slate-600 hover:bg-slate-50'
                                }`}
                            >
                                {activeTab === tab && <div className="nav-indicator" />}
                                <Icon name={tab} className={`w-5 h-5 transition-transform duration-300 ${activeTab === tab ? 'scale-110' : 'group-hover:scale-110'}`} />
                                <span className={`text-sm font-semibold capitalize tracking-tight ${activeTab === tab ? 'opacity-100' : 'opacity-80'}`}>{tab}</span>
                            </button>
                        ))}
                    </nav>

                    <div className="p-8">
                        <div className="bg-slate-900 p-6 rounded-3xl text-white relative overflow-hidden">
                            <p className="text-xs font-bold text-indigo-400 uppercase tracking-widest mb-1">PRO FEATURES</p>
                            <p className="text-sm font-medium leading-relaxed opacity-90">AI audits are active for your account.</p>
                            <div className="absolute -right-6 -bottom-6 w-20 h-20 bg-indigo-500/10 rounded-full blur-2xl" />
                        </div>
                    </div>
                </aside>

                {/* Mobile Top Bar */}
                <header className="md:hidden flex items-center justify-between p-6 sticky top-0 bg-white/80 backdrop-blur-xl z-50 border-b border-slate-100">
                    <div className="flex items-center gap-2">
                         <div className="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center text-white font-black text-sm">S</div>
                         <h1 className="font-bold tracking-tight">SpendWise</h1>
                    </div>
                    <button onClick={onAdd} className="w-10 h-10 bg-indigo-600 text-white rounded-xl flex items-center justify-center shadow-lg shadow-indigo-100 font-bold">+</button>
                </header>

                {/* Main Viewport */}
                <main className="flex-1 p-6 md:p-16 max-w-6xl mx-auto w-full pb-32 md:pb-16">
                    <header className="hidden md:flex justify-between items-end mb-16">
                        <div>
                            <h2 className="text-4xl font-black text-slate-900 tracking-tighter capitalize">{activeTab}</h2>
                            <p className="text-slate-400 font-medium mt-1">Refining your financial trajectory.</p>
                        </div>
                        <button 
                            onClick={onAdd}
                            className="bg-indigo-600 text-white px-10 py-4 rounded-2xl font-black shadow-2xl shadow-indigo-200 hover:bg-indigo-700 hover:-translate-y-1 transition-all active:scale-95"
                        >
                            + New Record
                        </button>
                    </header>
                    {children}
                </main>

                {/* Mobile Bottom Dock */}
                <nav className="md:hidden fixed bottom-6 left-6 right-6 glass-dock rounded-[2.5rem] border border-white/20 shadow-2xl z-50 px-8 py-3 flex justify-between items-center">
                    {['dashboard', 'transactions', 'insights', 'settings'].map(tab => (
                        <button 
                            key={tab} 
                            onClick={() => setActiveTab(tab)} 
                            className={`flex flex-col items-center p-2 rounded-2xl transition-all ${activeTab === tab ? 'text-indigo-600 bg-indigo-50' : 'text-slate-400'}`}
                        >
                            <Icon name={tab} className="w-6 h-6" />
                            <span className="text-[10px] font-black uppercase tracking-tighter mt-1">{tab.slice(0,4)}</span>
                        </button>
                    ))}
                </nav>
            </div>
        );

        const Dashboard = ({ transactions }) => {
            const totals = useMemo(() => {
                const income = transactions.filter(t => t.type === 'income').reduce((a, b) => a + Number(b.amount), 0);
                const expense = transactions.filter(t => t.type === 'expense').reduce((a, b) => a + Number(b.amount), 0);
                return { income, expense, balance: income - expense };
            }, [transactions]);

            const categoryData = useMemo(() => {
                const grouped = transactions.filter(t => t.type === 'expense').reduce((acc, t) => {
                    acc[t.category] = (acc[t.category] || 0) + Number(t.amount);
                    return acc;
                }, {});
                return Object.entries(grouped).map(([name, value]) => ({ name, value }));
            }, [transactions]);

            return (
                <div className="space-y-12 animate-in fade-in slide-in-from-bottom-8 duration-1000">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div className="bg-slate-900 p-10 rounded-[3rem] text-white shadow-2xl relative overflow-hidden group">
                            <div className="relative z-10">
                                <p className="text-indigo-300 text-[10px] font-black uppercase tracking-[0.2em] mb-2 opacity-80">NET LIQUIDITY</p>
                                <p className="text-5xl font-black tracking-tighter">${totals.balance.toLocaleString()}</p>
                            </div>
                            <div className="absolute top-0 right-0 w-48 h-48 bg-indigo-500/10 rounded-full blur-3xl -mr-10 -mt-10 group-hover:scale-125 transition-transform duration-700" />
                        </div>
                        <div className="premium-card p-10 rounded-[3rem]">
                            <p className="text-slate-400 text-[10px] font-black uppercase tracking-[0.2em] mb-2">INFLOW</p>
                            <p className="text-4xl font-bold text-emerald-600 tracking-tight">${totals.income.toLocaleString()}</p>
                        </div>
                        <div className="premium-card p-10 rounded-[3rem]">
                            <p className="text-slate-400 text-[10px] font-black uppercase tracking-[0.2em] mb-2">OUTFLOW</p>
                            <p className="text-4xl font-bold text-rose-500 tracking-tight">${totals.expense.toLocaleString()}</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-10">
                        <div className="premium-card p-10 rounded-[3rem] h-[450px] flex flex-col">
                            <h3 className="text-xl font-black text-slate-800 mb-8 tracking-tight">Spending Clusters</h3>
                            <div className="flex-1">
                                <ResponsiveContainer width="100%" height="100%">
                                    <PieChart>
                                        <Pie data={categoryData} innerRadius={100} outerRadius={140} paddingAngle={10} dataKey="value" stroke="none">
                                            {categoryData.map((e, i) => <Cell key={i} fill={CATEGORY_COLORS[e.name]} />)}
                                        </Pie>
                                        <Tooltip 
                                            contentStyle={{ borderRadius: '24px', border: 'none', boxShadow: '0 20px 40px rgba(0,0,0,0.1)', padding: '16px' }} 
                                            itemStyle={{ fontWeight: 800, fontSize: '14px' }}
                                        />
                                    </PieChart>
                                </ResponsiveContainer>
                            </div>
                        </div>

                        <div className="premium-card p-10 rounded-[3rem] flex flex-col">
                            <h3 className="text-xl font-black text-slate-800 mb-8 tracking-tight">Recent Activity</h3>
                            <div className="space-y-4 overflow-y-auto max-h-[300px] hide-scrollbar pr-2">
                                {transactions.slice(0, 10).map(t => (
                                    <div key={t.id} className="flex justify-between items-center p-5 bg-slate-50/50 hover:bg-white rounded-2xl transition-all border border-transparent hover:border-slate-100 hover:shadow-sm">
                                        <div className="flex items-center gap-4">
                                            <div className="w-12 h-12 rounded-2xl flex items-center justify-center bg-white shadow-sm border border-slate-100 text-xl">
                                                {t.type === 'income' ? 'ðŸ’¹' : 'ðŸ“‰'}
                                            </div>
                                            <div>
                                                <p className="font-bold text-slate-900 leading-tight mb-0.5">{t.title}</p>
                                                <p className="text-[10px] font-black text-indigo-500 uppercase tracking-widest opacity-60">{t.category}</p>
                                            </div>
                                        </div>
                                        <p className={`text-lg font-black tracking-tight ${t.type === 'income' ? 'text-emerald-600' : 'text-slate-900'}`}>
                                            {t.type === 'income' ? '+' : '-'}${Number(t.amount).toFixed(2)}
                                        </p>
                                    </div>
                                ))}
                                {transactions.length === 0 && <p className="text-center py-20 text-slate-400 italic font-medium">No records found. Start by adding one.</p>}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const TransactionForm = ({ onSave, onClose, initialData }) => {
            const [data, setData] = useState(initialData || { 
                title: '', amount: '', date: new Date().toISOString().split('T')[0], category: 'Other', type: 'expense' 
            });
            const [isAIThinking, setIsAIThinking] = useState(false);

            const autoCategorize = async () => {
                if (data.title.length > 3 && !initialData) {
                    setIsAIThinking(true);
                    const cat = await geminiService.suggestCategory(data.title);
                    setData(d => ({...d, category: cat}));
                    setIsAIThinking(false);
                }
            };

            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-slate-900/60 backdrop-blur-md">
                    <div className="bg-white w-full max-w-xl rounded-[3rem] p-12 shadow-2xl animate-in zoom-in-95 duration-500">
                        <div className="flex justify-between items-start mb-10">
                            <h2 className="text-3xl font-black text-slate-900 tracking-tighter">{initialData ? 'Update' : 'Capture'} Entry</h2>
                            <button onClick={onClose} className="p-3 hover:bg-slate-100 rounded-2xl transition-all">
                                <svg className="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="3" d="M6 18L18 6M6 6l12 12"/></svg>
                            </button>
                        </div>
                        <div className="space-y-8">
                            <div className="flex bg-slate-100 p-2 rounded-3xl">
                                {['expense', 'income'].map(type => (
                                    <button 
                                        key={type} 
                                        onClick={() => setData({...data, type})} 
                                        className={`flex-1 py-4 rounded-[1.25rem] text-sm font-black uppercase tracking-widest transition-all ${data.type === type ? 'bg-white shadow-md text-indigo-600' : 'text-slate-400'}`}
                                    >
                                        {type}
                                    </button>
                                ))}
                            </div>
                            <div className="relative">
                                <input 
                                    placeholder="Transaction Narrative" 
                                    onBlur={autoCategorize}
                                    value={data.title} 
                                    onChange={e => setData({...data, title: e.target.value})} 
                                    className="w-full px-8 py-5 bg-slate-50 border-none rounded-[1.5rem] focus:ring-4 focus:ring-indigo-100 font-bold text-lg placeholder:text-slate-300" 
                                />
                                {isAIThinking && <div className="absolute right-6 top-1/2 -translate-y-1/2 text-[10px] font-black text-indigo-500 animate-pulse tracking-widest">AI SCANNING...</div>}
                            </div>
                            <div className="grid grid-cols-2 gap-6">
                                <input type="number" placeholder="0.00" value={data.amount} onChange={e => setData({...data, amount: e.target.value})} className="w-full px-8 py-5 bg-slate-50 border-none rounded-[1.5rem] focus:ring-4 focus:ring-indigo-100 font-black text-2xl" />
                                <input type="date" value={data.date} onChange={e => setData({...data, date: e.target.value})} className="w-full px-8 py-5 bg-slate-50 border-none rounded-[1.5rem] focus:ring-4 focus:ring-indigo-100 font-bold" />
                            </div>
                            <select value={data.category} onChange={e => setData({...data, category: e.target.value})} className="w-full px-8 py-5 bg-slate-50 border-none rounded-[1.5rem] focus:ring-4 focus:ring-indigo-100 font-bold appearance-none">
                                {Object.values(Category).map(c => <option key={c} value={c}>{c}</option>)}
                            </select>
                            <button 
                                onClick={() => {
                                    if(!data.title || !data.amount) return;
                                    onSave({...data, id: data.id || Math.random().toString(36).substr(2, 9)});
                                }} 
                                className="w-full py-6 bg-slate-900 text-white rounded-[2rem] font-black text-xl shadow-2xl hover:bg-slate-800 active:scale-95 transition-all mt-4 uppercase tracking-[0.1em]"
                            >
                                Secure Entry
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('dashboard');
            const [transactions, setTransactions] = useState([]);
            const [loading, setLoading] = useState(true);
            const [isFormOpen, setIsFormOpen] = useState(false);
            const [editing, setEditing] = useState(null);
            const [aiInsight, setAiInsight] = useState(null);
            const [isAiLoading, setIsAiLoading] = useState(false);

            const load = async () => {
                setLoading(true);
                const data = await db.getTransactions();
                setTransactions(data);
                setLoading(false);
            };

            useEffect(() => { load(); }, []);

            const save = async (t) => {
                await db.saveTransaction(t);
                await load();
                setIsFormOpen(false);
                setEditing(null);
            };

            const del = async (id) => {
                if(confirm('Archive this record?')) { await db.deleteTransaction(id); await load(); }
            };

            const runAiAudit = async () => {
                if (transactions.length < 3) return alert("Requires minimum 3 entries.");
                setIsAiLoading(true);
                const result = await geminiService.getFinancialInsights(transactions);
                setAiInsight(result);
                setIsAiLoading(false);
            };

            return (
                <Layout activeTab={activeTab} setActiveTab={setActiveTab} onAdd={() => setIsFormOpen(true)}>
                    {loading ? (
                        <div className="flex flex-col items-center justify-center py-40 gap-6">
                            <div className="w-16 h-16 border-8 border-indigo-600 border-t-transparent rounded-full animate-spin shadow-xl"></div>
                            <p className="text-slate-400 font-black uppercase tracking-[0.3em] animate-pulse">Establishing MySQL Node</p>
                        </div>
                    ) : (
                        <div className="animate-in fade-in duration-700">
                            {activeTab === 'dashboard' && <Dashboard transactions={transactions} />}
                            {activeTab === 'transactions' && (
                                <div className="premium-card rounded-[3rem] overflow-hidden">
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-left border-collapse">
                                            <thead>
                                                <tr className="bg-slate-50/50">
                                                    <th className="px-10 py-8 text-[10px] font-black text-slate-400 uppercase tracking-widest">Date Index</th>
                                                    <th className="px-10 py-8 text-[10px] font-black text-slate-400 uppercase tracking-widest">Narration</th>
                                                    <th className="px-10 py-8 text-[10px] font-black text-slate-400 uppercase tracking-widest text-right">Magnitude</th>
                                                    <th className="px-10 py-8"></th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-50">
                                                {transactions.map(t => (
                                                    <tr key={t.id} className="hover:bg-slate-50/30 transition-colors group">
                                                        <td className="px-10 py-8 text-sm font-semibold text-slate-400">{new Date(t.date).toLocaleDateString(undefined, {month: 'short', day: 'numeric', year: 'numeric'})}</td>
                                                        <td className="px-10 py-8">
                                                            <p className="text-base font-bold text-slate-900 leading-tight mb-1">{t.title}</p>
                                                            <span className="text-[10px] font-black text-indigo-500 bg-indigo-50 px-2 py-0.5 rounded-md uppercase tracking-widest">{t.category}</span>
                                                        </td>
                                                        <td className={`px-10 py-8 text-xl font-black text-right ${t.type === 'income' ? 'text-emerald-600' : 'text-slate-900'}`}>
                                                            {t.type === 'income' ? '+' : '-'}${Number(t.amount).toFixed(2)}
                                                        </td>
                                                        <td className="px-10 py-8 text-right opacity-0 group-hover:opacity-100 transition-opacity">
                                                            <div className="flex justify-end gap-3">
                                                                <button onClick={() => {setEditing(t); setIsFormOpen(true);}} className="p-2 text-indigo-500 hover:bg-indigo-50 rounded-xl transition-all"><Icon name="settings" className="w-5 h-5" /></button>
                                                                <button onClick={() => del(t.id)} className="p-2 text-rose-500 hover:bg-rose-50 rounded-xl transition-all"><svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ))}
                                                {transactions.length === 0 && <tr><td colSpan="4" className="text-center py-32 text-slate-400 font-bold uppercase tracking-widest">Database Null</td></tr>}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            )}
                            {activeTab === 'insights' && (
                                <div className="space-y-10">
                                    <div className="bg-gradient-to-br from-indigo-700 to-indigo-900 p-16 rounded-[4rem] text-white shadow-2xl relative overflow-hidden text-center md:text-left flex flex-col md:flex-row items-center gap-12">
                                        <div className="relative z-10 flex-1">
                                            <div className="inline-block p-4 bg-white/10 rounded-3xl backdrop-blur-md mb-8">âœ¨ Gemini Intelligence</div>
                                            <h3 className="text-5xl font-black mb-6 tracking-tighter leading-tight">Quantify your potential.</h3>
                                            <p className="text-indigo-100 text-lg max-w-xl opacity-90 leading-relaxed">Our AI analyzes thousands of data points to generate actionable optimization strategies for your capital.</p>
                                            <button 
                                                onClick={runAiAudit}
                                                disabled={isAiLoading}
                                                className="mt-10 px-12 py-5 bg-white text-indigo-900 rounded-[2rem] font-black shadow-2xl hover:-translate-y-1 transition-all disabled:opacity-50"
                                            >
                                                {isAiLoading ? 'SYNCING AI ENGINE...' : 'INITIATE AUDIT'}
                                            </button>
                                        </div>
                                        <div className="w-64 h-64 bg-indigo-500/20 rounded-full blur-3xl absolute bottom-0 right-0 -mb-20 -mr-20" />
                                    </div>
                                    
                                    {aiInsight && (
                                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-10 animate-in slide-in-from-top-10 duration-700">
                                            <div className="premium-card p-12 rounded-[3.5rem]">
                                                <h4 className="text-indigo-600 font-black uppercase tracking-widest text-xs mb-6">Strategic Summary</h4>
                                                <p className="text-slate-600 text-lg leading-relaxed font-medium">{aiInsight.summary}</p>
                                            </div>
                                            <div className="premium-card p-12 rounded-[3.5rem]">
                                                <h4 className="text-emerald-600 font-black uppercase tracking-widest text-xs mb-6">Efficiency Gain</h4>
                                                <p className="text-slate-600 text-lg leading-relaxed font-medium">{aiInsight.savingsPotential}</p>
                                            </div>
                                            <div className="premium-card p-12 rounded-[3.5rem] lg:col-span-2">
                                                <h4 className="text-indigo-600 font-black uppercase tracking-widest text-xs mb-8">Action Directives</h4>
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                                    {aiInsight.recommendations.map((rec, i) => (
                                                        <div key={i} className="flex gap-6 items-start p-8 bg-slate-50 rounded-[2.5rem] hover:bg-white border border-transparent hover:border-slate-100 transition-all">
                                                            <div className="w-10 h-10 bg-indigo-600 text-white rounded-xl flex items-center justify-center font-black flex-shrink-0">{i+1}</div>
                                                            <p className="text-slate-700 font-bold leading-relaxed">{rec}</p>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            )}
                            {activeTab === 'settings' && (
                                <div className="max-w-2xl mx-auto space-y-8">
                                    <div className="premium-card p-16 rounded-[4rem] text-center">
                                        <div className="w-32 h-32 bg-slate-900 text-white rounded-[3rem] flex items-center justify-center mx-auto mb-10 text-5xl font-black shadow-2xl">JS</div>
                                        <h3 className="text-3xl font-black text-slate-900 mb-2">John Smith</h3>
                                        <p className="text-slate-400 font-black uppercase tracking-widest text-xs mb-10">Pro License Active</p>
                                        <div className="space-y-4">
                                            <button onClick={() => window.location.reload()} className="w-full py-5 bg-indigo-600 text-white rounded-[1.5rem] font-black shadow-xl hover:-translate-y-1 transition-all uppercase tracking-widest text-sm">Refresh Cloud Sync</button>
                                            <button onClick={() => { localStorage.clear(); window.location.reload(); }} className="w-full py-5 bg-slate-100 text-slate-500 rounded-[1.5rem] font-bold hover:bg-slate-200 transition-all uppercase tracking-widest text-xs">Purge Cache</button>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 gap-6">
                                        <div className="premium-card p-10 rounded-[2.5rem] text-center">
                                            <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">DB Latency</p>
                                            <p className="text-2xl font-black text-emerald-500">12ms</p>
                                        </div>
                                        <div className="premium-card p-10 rounded-[2.5rem] text-center">
                                            <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Node Type</p>
                                            <p className="text-2xl font-black text-slate-900">MySQL</p>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    )}

                    {isFormOpen && <TransactionForm initialData={editing} onSave={save} onClose={() => {setIsFormOpen(false); setEditing(null);}} />}
                </Layout>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
